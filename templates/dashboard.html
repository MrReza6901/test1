<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¹Ù‡Ø¯ Ø¬Ù…Ø¹ÛŒ - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 1rem;
      direction: rtl;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 1.5rem 2rem;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-weight: 700;
      text-align: center;
      color: #2a7f35;
    }
    form {
      margin-bottom: 1.5rem;
    }
    .member-item {
      display: flex;
      align-items: center;
      padding: 0.4rem 0;
      border-bottom: 1px solid #eee;
      font-size: 1.1rem;
    }
    .member-item label {
      cursor: pointer;
      flex-grow: 1;
    }
    input[type="checkbox"] {
      margin-left: 1rem;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 0.7rem;
      background-color: #2a7f35;
      color: white;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.25s ease;
    }
    button:hover {
      background-color: #1e5b24;
    }
    #export-output {
      white-space: pre-wrap;
      background: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      font-size: 1rem;
      line-height: 1.5;
      height: 320px;
      overflow-y: auto;
      user-select: all;
    }
    @media (max-width: 640px) {
      .container {
        padding: 1rem;
        margin: 0.5rem;
      }
      .member-item {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“– Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¹Ù‡Ø¯ Ø¬Ù…Ø¹ÛŒ - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ğŸ“–</h2>
    <p style="text-align:center; margin-bottom:1.5rem;">
      ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ²: <span id="today-date"></span>
    </p>

    <form id="checkin-form">
      <div id="members-list"></div>
      <button type="submit">Ø«Ø¨Øª ÙˆØ¶Ø¹ÛŒØª Ø§Ù…Ø±ÙˆØ²</button>
    </form>

    <form id="add-member-form" style="margin-bottom:1.5rem;">
      <input type="text" id="new-member-name" placeholder="Ù†Ø§Ù… Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯" autocomplete="off" />
      <button type="submit">Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ</button>
    </form>

    <h3>ğŸ“„ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ù…Ø±ÙˆØ²:</h3>
    <pre id="export-output" readonly></pre>
  </div>

  <script>
    // Ø§Ø¹Ø¶Ø§ Ø§ÙˆÙ„ÛŒÙ‡ (ØªØ±ØªÛŒØ¨ Ø§Ù„ÙØ¨Ø§ÛŒÛŒ Ø±Ø¹Ø§ÛŒØª Ø´Ø¯Ù‡)
    let members = [
      "Ø§Ø³Ù…Ø§Ø¹ÛŒÙ„ÛŒ Ø±Ø¶Ø§", "Ø§Ù…ÛŒØ±ÛŒ ØµØ§Ø¯Ù‚", "Ø§Ù…ÛŒØ±ÛŒ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÛŒ", "Ø¨Ø±Ø¯Ø³ØªØ§Ù†ÛŒ Ø­Ø³ÛŒÙ†", "Ø¯Ø±Ù‡ Ø²Ø±Ø´Ú©ÛŒ Ø­Ù…ÛŒØ¯",
      "Ø¯Ù‡Ù‚Ø§Ù† Ù…ØµØ·ÙÛŒ", "Ø±ÙÛŒØ¹ Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§", "Ø±ÙˆØ­ Ù¾Ø±ÙˆØ± Ù…Ù‡Ø¯ÛŒ", "Ø±ÙˆØ­ Ù¾Ø±ÙˆØ± Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§", "Ø±Ø¶Ø§ÛŒÛŒ Ø§ÛŒÙ„ÛŒØ§",
      "Ø³Ù„Ù…Ø§Ù†ÛŒ Ù…Ø¬ÛŒØ¯", "Ø´ÙÛŒØ¹ÛŒ Ù…Ù‡Ø¯ÛŒ", "Ø´Ù†Ø§ÙˆØ± Ù…Ø­Ø³Ù†", "Ø´ÛŒØ®ÛŒ Ø§Ø¨Ø±Ø§Ù‡ÛŒÙ…", "Ø¶Ø±ØºØ§Ù… Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­",
      "Ø¹Ø¨Ø§Ø³ÛŒ Ø²Ù‡ÛŒØ±", "ØºÙ„Ø§Ù…ÛŒ Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÛŒ", "ÙØ±Ù‡Ø§Ø¯ÛŒ Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„", "ÙÙ„Ø§Ø­ Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§", "ÙÙ„Ø§Ø­ØªÛŒ Ø±ÙˆØ­ Ø§Ù„Ù„Ù‡",
      "Ù‚Ø§Ø³Ù…ÛŒØ§Ù† Ø³ÛŒØ¯ Ø¬Ù…Ø§Ù„", "Ù‚Ø§Ø³Ù…ÛŒØ§Ù† Ø³ÛŒØ¯ Ù…Ø¬ØªØ¨ÛŒ", "Ù…Ø´Ù‡Ø¯ÛŒ Ø¨Ø§ÙØ§Ù† Ù…Ø­Ø³Ù†", "Ù…Ù†ØµÙˆØ±ÛŒØ§Ù† Ù‡Ø§Ø¯ÛŒ",
      "Ù†Ø¹Ù…ØªÛŒ Ø¹Ù„ÛŒ", "Ù†ÙˆØ±ÛŒ Ú©Ø§Ø¸Ù…"
    ];

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø§Ø² localStorage ÛŒØ§ Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
    let status = JSON.parse(localStorage.getItem('prayerCheckStatus')) || {};

    // ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø´Ù…Ø³ÛŒ (ØªÙ‚Ø±ÛŒØ¨ÛŒ)
    function getTodayJalali() {
      const gregorian = new Date();
      const months = ["ÙØ±ÙˆØ±Ø¯ÛŒÙ†","Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª","Ø®Ø±Ø¯Ø§Ø¯","ØªÛŒØ±","Ù…Ø±Ø¯Ø§Ø¯","Ø´Ù‡Ø±ÛŒÙˆØ±","Ù…Ù‡Ø±","Ø¢Ø¨Ø§Ù†","Ø¢Ø°Ø±","Ø¯ÛŒ","Ø¨Ù‡Ù…Ù†","Ø§Ø³ÙÙ†Ø¯"];
      // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ (ÙÙ‚Ø· ØªØ§Ø±ÛŒØ® Ùˆ Ù…Ø§Ù‡ Ø³Ø§Ø¯Ù‡)
      // Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ú©Ø§Ù…Ù„ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ moment-jalaali ÛŒØ§ Ù…Ø´Ø§Ø¨Ù‡ Ù…ÛŒâ€ŒØ´Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯ ÙˆÙ„ÛŒ Ù‡Ù…ÛŒÙ† Ú©Ø§ÙÛŒÙ‡
      const day = gregorian.getDate();
      const month = gregorian.getMonth() + 1;
      const year = gregorian.getFullYear();

      // ØªØ¨Ø¯ÛŒÙ„ Ø³Ø§Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡) - Ù…ÛŒØ´Ù‡ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
      const jalaliYear = year - 621;
      let jalaliMonth = month;
      let jalaliDay = day;
      // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ø¯Ù‡
      if(month < 3 || (month === 3 && day < 21)) jalaliYear--;

      return `${jalaliYear}/${('0'+jalaliMonth).slice(-2)}/${('0'+jalaliDay).slice(-2)}`;
    }

    // Ø±Ù†Ø¯Ø± Ø§Ø¹Ø¶Ø§ Ùˆ ÙˆØ¶Ø¹ÛŒØª ØªÛŒÚ©â€ŒÙ‡Ø§
    function renderMembers() {
      const container = document.getElementById('members-list');
      container.innerHTML = '';
      // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø±ÙˆÙ Ø§Ù„ÙØ¨Ø§
      members.sort((a,b) => a.localeCompare(b));
      members.forEach((name, idx) => {
        const div = document.createElement('div');
        div.classList.add('member-item');

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `chk-${idx}`;
        checkbox.value = name;
        checkbox.checked = !!status[name];

        const label = document.createElement('label');
        label.htmlFor = checkbox.id;
        label.textContent = `${idx + 1}. ${name}`;

        div.appendChild(label);
        div.appendChild(checkbox);
        container.appendChild(div);
      });
    }

    // Ø³Ø§Ø®Øª Ø®Ø±ÙˆØ¬ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ù‡ ÙØ±Ù…Øª Ø¯Ù„Ø®ÙˆØ§Ù‡
    function generateOutput() {
      const date = document.getElementById('today-date').textContent;
      let output = `ğŸ“–Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¹Ù‡Ø¯ Ø¬Ù…Ø¹ÛŒğŸ“–\n\nâŒšï¸ ${date} âŒšï¸\n\nØ§Ø³Ø§Ù…ÛŒ Ø§Ø¹Ø¶Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø­Ø±ÙˆÙ Ø§Ù„ÙØ¨Ø§ \n\nØ¬Ù†Ø§Ø¨ Ø¢Ù‚Ø§ÛŒØ§Ù†\n`;
      members.sort((a,b) => a.localeCompare(b)).forEach((name, idx) => {
        const symbol = status[name] ? 'ğŸŒ¸' : 'ğŸ¥º';
        output += ` ${idx + 1}. ${name} ${symbol}\n`;
      });
      return output;
    }

    // Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¯Ø± localStorage
    function saveStatus() {
      localStorage.setItem('prayerCheckStatus', JSON.stringify(status));
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø«Ø¨Øª ÙØ±Ù… ØªÛŒÚ©â€ŒØ²Ø¯Ù†
    document.getElementById('checkin-form').addEventListener('submit', e => {
      e.preventDefault();
      const checkboxes = document.querySelectorAll('#members-list input[type="checkbox"]');
      checkboxes.forEach(cb => {
        status[cb.value] = cb.checked;
      });
      saveStatus();
      updateExport();
      alert('ÙˆØ¶Ø¹ÛŒØª Ø§Ù…Ø±ÙˆØ² Ø«Ø¨Øª Ø´Ø¯ âœ…');
    });

    // Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯
    document.getElementById('add-member-form').addEventListener('submit', e => {
      e.preventDefault();
      const input = document.getElementById('new-member-name');
      let newName = input.value.trim();
      if(newName === '') {
        alert('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        return;
      }
      if(members.includes(newName)) {
        alert('Ø§ÛŒÙ† Ø¹Ø¶Ùˆ Ù‚Ø¨Ù„Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.');
        return;
      }
      members.push(newName);
      status[newName] = false;
      saveStatus();
      renderMembers();
      updateExport();
      input.value = '';
    });

    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªÙ† Ø®Ø±ÙˆØ¬ÛŒ Ø±ÙˆÛŒ ØµÙØ­Ù‡
    function updateExport() {
      document.getElementById('export-output').textContent = generateOutput();
    }

    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    document.getElementById('today-date').textContent = getTodayJalali();
    renderMembers();
    updateExport();
  </script>
</body>
</html>
